---
layout:     post
title:      "多环境配置"
subtitle:   ""
description: "记录在Swift开发中常用的小技巧，方便忘记的时候查阅"
excerpt: ""
date:       2018-04-13 19:22:00
author:     "Cheng"
image: "https://img.zhaohuabing.com/in-post/2018-04-11-service-mesh-vs-api-gateway/background.jpg"
published: true
tags:
    - IOS
URL: "/2018/04/2/ios/"
categories: [ IOS ]


---



# 多环境配置

项目中常常会遇到多个app环境，比如开发环境，测试环境，预发布环境，发布环境等，当需要开发打多个包的时候，一般常见做法就是直接代码里面修改环境变量，改完之后Archive一下就打包了。当然这种做法很正确，只不过不是很优雅很高效。如果搭建好了Jenkins([搭建教程](https://www.jianshu.com/p/41ecb06ae95f))，我们利用它来优雅的打包。如果利用Jenkins来打包，我们就需要来给app来配置一下多个环境变量了。之后Jenkins分别再不同环境下自动集成即可

## 一、利用Build Configuration来配置多环境

### 1. 新建Build Configuration

[官方文档](https://link.jianshu.com/?t=https%3A%2F%2Fdeveloper.apple.com%2Flibrary%2Fios%2Frecipes%2Fxcode_help-project_editor%2FArticles%2FBasingBuildConfigurationsonConfigurationFiles.html)，[新版文档链接在这里Build settings reference](https://link.jianshu.com/?t=https%3A%2F%2Fhelp.apple.com%2Fxcode%2Fmac%2F8.0%2F%23%2Fitcaec37c2a6)。

先点击Project里面找到Configuration，然后选择添加，这里新加一个Configuration。系统默认是2个，一个Debug，一个Release。这里我们需要选择是复制一个Debug还是Release。Release和Debug的区别是，Release是不能调试程序，因为默认是屏蔽了可调试的一些参数，具体可以看BuildSetting里面的区别，而且Release编译时有做编译优化，会比用Debug打包出来的体积更小一点。

![configuration](/img/iOS/Snipaste_2021-04-02_18-21-49.png)

注意：刚刚新建完Build Configuration之后，这时如果有pod，请立即执行一下

```
pod install  
```

pod安装完成之后会自动生成xcconfig文件，如果你手动新建这个xcconfig，然后把原来的debug和release对应的pod xcconfig文件内容复制进来，这样做是无效的，需要pod自己去生成xcconfig文件才能被识别到。

新建完Build Configuration，这个时候需要新建pod里面对应的Build Configuration，要不然一会编译会报错。如果没用pod，可以忽略一下这一段。

然后就可以选择不同的configuration进行运行或者打包![Snipaste_2021-04-02_20-20-11](/img/iOS/Snipaste_2021-04-02_20-20-11.png)

或者新建一个Scheme，不用每次都去修改

#### 用宏定义来区分每个Configuration配置下的环境

比如这样的定义，如果configuration选择的是Devleop，然后下面打印只会在Devleop下的DEBUG下才会执行

```swift
#if DEBUG
print("DEBUG")
#endif
```

在OC项目中需要在`Build Settings中的Preprocessing`定义

![Snipaste_2021-04-02_20-17-39](/img/iOS/Snipaste_2021-04-02_20-17-39.png)

上图配置，如果选中的是Develop，那么代码里只有宏DEVELOP，和DEBUG才会执行

`Swfit`项目需要在`Build Settings ->Swift Compiler - CustomFlags `中进行配置

![Snipaste_2021-04-02_20-28-17](/img/iOS/Snipaste_2021-04-02_20-28-17.png)

#### 新建User-defined Build Settings

再次回到Project或者单独的Target的Build Settings里面来，Add User-Defined Setting。

##### 自定义appName

![Snipaste_2021-04-02_20-40-18](/img/iOS/Snipaste_2021-04-02_20-40-18.png)

然后将info.plist中的Bundle name修改为自定义的AppName

![Snipaste_2021-04-02_20-45-03](/img/iOS/Snipaste_2021-04-02_20-45-03.png)

##### `bundle Identifier`配置

![Snipaste_2021-04-02_20-50-34](/img/iOS/Snipaste_2021-04-02_20-50-34.png)

##### AppIcon、Launch Image配置

![Snipaste_2021-04-02_21-14-55](/img/iOS/Snipaste_2021-04-02_21-14-55.png)

对应的资源文件 

![Snipaste_2021-04-02_21-15-11](/img/iOS/Snipaste_2021-04-02_21-15-11.png)

然后根据项目自己选择对应的icon

![Snipaste_2021-04-02_21-18-06](/img/iOS/Snipaste_2021-04-02_21-18-06.png)

##### 版本信息

![Snipaste_2021-04-02_21-24-41](/img/iOS/Snipaste_2021-04-02_21-24-41.png)

在`info.plist`中修改`Bundle version`为`$(CURRENT_PROJECT_VERSION)`

![Snipaste_2021-04-02_21-27-10](/img/iOS/Snipaste_2021-04-02_21-27-10.png)

还有就是签名信息等都可以按照上面的方式配置

## 二、新建多Target





参考：

https://www.jianshu.com/p/83b6e781eb51l

